---
title: "Late Pleistocene stone artefact technology at Mau A, Yen Bai, Norther Vietnam"
author:
  - Quinn Habedank:
      email: fl@oneoeurhg.edu
      institute: [UofO]
      correspondence: true
  - Ben Marwick:
      email: fl@another.edu
      institute: [UofA]
      correspondence: false
institute:
  - UofO: University of One Place
  - UofA: University of Another Place
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300
)
```

<!-- The actual document text starts here: -->

# Abstract

Flaked stone artefacts from Southeast Asia typically lack visually distinctive and strongly patterned forms, which can make them challenging to analyze and interpret. As a result, many of the cultural dynamics of Pleistocene hunter-gatherers of this region are poorly understood. We use 2D shape data to hypothesize a relationship between unretouched flake shape and assemblage reduction intensity at Mau A, an early Holocene archaeological site in northern Vietnam. We apply a Principal Components Analysis to the flake outlines to investigate shape variation throughout the reduction sequence (measured by dorsal cortex coverage). We find that flake shape varies by reduction stage, primarily through differences in flake length and width. Our results suggest that flake shape is sensitive to assemblage reduction intensity, and may give useful comparative insights when other attributes show little variation. These results are important for understanding stone artefact assemblages from Southeast Asia which often yield little variation when analysed with traditional approaches.

## Introduction

- Stone tools from South East Asia tend to lack distinctive typological categories (Mijares 2008; Borel et al. 2013; Borel et al. 2017)
- The purpose of this study was to examine the relationship between flake shape and reduction intensity
- Approach used in the paper is a response to the lack of traditional typological categories in South East Asia

Here is a citation [@Marwick2017]

<!-- BM: In this section we need to review previous work on investigating flake shape and identifying what affects flake shape, not just in Southeast Asia, but anywhere in the world -->

## Excavations at Mau A

Mau A is an open air archaeological site located on the banks above 5 m above the Red River in Yen Bai Province, Northern Vietnam, at the confluence of a small stream entering the river. Excavations were conducted in 2015 by a collaboration including researchers from the University of Washington, the Yen Bai Provincial Museum, the Institute of Archaeology in Hanoi, and the Vietnam National University - Social Sciences and Humanities University. An area of 2 x 2 m was excavated in 13 units of ten centimeters deep, through dense silty clay deposits to a depth of about 1.3 m below the surface. Subtle changes in stratigraphy indicated a slightly sloping deposit with four layers, consistent with reports of excavations in this location in the 1980s. A small amount of plastic and modern ceramics were found in the uppermost 0.1 m of deposit. The most striking feature identified during our excavations was the third layer, which is distinctive as very dense layer of flaked stone artefacts at about 0.6-1.1 m below the surface. No other features were identified during excavation.

This dense lithic layer contained the majority of stone artefacts recovered from the site. The  chaîne opératoire of Mau A lithic technology is composed of unifacial shaping on long cobbles to produce sumatraloids (sumatralith-like pieces). The chaîne opératoire also involved the shaping of thick ovoid cobbles for the production of choppers or chopping-tools and half-cobbles (longitudinally split) that are shaped into tools with transverse cutting edges. Flake scar surfaces and edges are fresh and unweathered, indicating _in situ_ production and limited post-depositional movement. While previous work has claimed the Mau A assemblage is Son Vian (a precurser to Hoabinhian technology, characterised by unifacial flaking of blocky, cubic cobbles)

<!-- BM: need to cite The Oxford Handbook of the Archaeology and Anthropology of Hunter-Gatherers, Ha Van Tan 1997, and the Proceedings of the Prehistoric Society -->

Four radiocarbon ages were obtained from isolated charcoal fragments in the deposit. The charcoal was sampled to bracket the upper and lower boundaries of the dense lithic layer. <!-- add calibrated age numbers here --> The ages indicate a rapid accumulation process for this layer at the terminal Pleistocene. 

<!-- BM: add a paragraph on MH's pollen analysis to indicate local palaeoenvironment, and add her as co-author-->


## Methods

We initially recorded conventional linear dimension measurements, such as max dimension length and width at various points along the max dimension length, from all flakes recovered from the excavation. Then we converted these linear dimensions into landmarks points to represent the size and shape of each artefact. The specific linear measurements used to create the 2D landmarks were the top horizontal measurement, the max dimension length, width at a quarter of the maximum length, width at half of the maximum length, and width at three quarters of the maximum length.

<!-- BM: Because our approach here is very novel, most readers will struggle to understand it. To help them, I think we will need a table that defines each of our dimensions, and a figure that shows an example of our landmark points on a typical artefact -->

The outlines formed by the shape landmarks were then normalized for size, orientation, and rotation. We used Generalized Procrustes analysis to strip the flakes in the sample dataset of size, orientation, and rotation, leaving only shape data.  Our methodology for carrying out the PCA on the shape landmarks was inspired by Theska et al. (2020), which also performed 2D landmark data analysis using PCA. Finally, the shape landmark values were analysed by Principal Components Analysis. PCA biplots were created to visualize differences based upon secondary categorical variables, namely flake reduction categories, excavation unit, and mass cluster. The first two primary components were then used to create biplots comparing the shape data to the flake reduction categories, excavation unit, and mass clusters, with the secondary variables being represented by colored outlines on the biplots. 

<!-- BM: Need to add citations to give the reader further information on GPA and shape analysis in archaeology. Need to add a sentence of definitino of what is GPA and what is PCA. Partly to guide the reader to more details, if they want it, and partly to demonstrate our expertise with the method -->

Reduction categories were based upon dorsal cortex percentages were discretized based upon standard cut points. Flakes with no dorsal cortex were categorized as tertiary flakes, those with up to a dorsal cortex percentage of 50% were considered secondary and those with a dorsal cortex value greater than 50% were considered primary (Bradbury & Carr 1995). Mass clusters were generated using univariate k-means, with the end result being 6 mass clusters, with mass cluster 1 having the least mass on average and 6 having the greatest mass on average. 

<!-- BM: Need to add citations and definition about univariate k-means -->

## Results

<!-- BM: basic stats on raw materials and change in technology by depth to satisfy readers about the basic details of the assemblage, 

<!-- BM: then QH's more complex analysis on flakes after the basic data -->

<!-- BM: then previous more complex analysis on cores after QH's analysis of flakes -->

<!--QH: Just putting all of the code and writing here. Not going to worry about formatting for now -->
<!--QH: On a secondary note, I managed to cause an error with docker in record time. We will need to fix that later-->
<!--QH: Lastly, I'm going to do my best to get the code working tonight. If that fails, I will still write up my interpretation using prior images of the visualization-->

```{r}
library(tidyverse)

# import the data
ma_flakes <- readxl::read_excel(here::here("data/UW Fieldschool Mau A 2015 post_excavation_season_April_2016.xlsx"),
                                col_names = FALSE)

# transpose so that columns are variables, rows are individual artefacts
# and set col data types so we can compute on them
ma_flakes_tr <-
ma_flakes %>%
  pivot_longer(-`...1`)  %>%
  pivot_wider(names_from = `...1`,
              values_from = value) %>%
  mutate_all(parse_guess) %>%
  # fix a few bad guesses
  mutate(across(c(mass,
                thickness_at_0.25_width,
                thickness_at_0.75_width,
                dorsal_cortex_perc,
                dorsal_scar_initiation_count),
         parse_number))

# export this data frame to use with our analysis
write_csv(ma_flakes_tr,
          here::here("data/ma_flakes_tr.csv"))

```

```{r}
# here we import the CSV file of caliper measurements, then compute on the
# measurements to generate coordinates for a shape outline

library(tidyverse)

# import
ma_flakes_tr <- read_csv(here::here("data/ma_flakes_tr.csv"))

# custom function is from here, we have a local version in 999-functions.R
# so we can work offline if we need to
# https://gist.github.com/benmarwick/fac5754131c1fcc14d32b1658215f0e3

source(here::here("code/999-functions.R"))

polys <- polygon_shape_by_variables(data = ma_flakes_tr,       # our data frame
                                    x = 'width_at_0.50_length',                # col for coord for x-axis of poly centers
                                    y = 'max_dimension',       # col for coord for y-axis of poly centers

                                    sf = 10,    # scale factor
                                    top_horizontal_measurement =    'platform_width', # cols to use to compute poly verts
                                    main_vertical_measurement =     'percussion_length',
                                    upper_horizontal_measurement =  'width_at_0.25_length',
                                    middle_horizontal_measurement = 'width_at_0.50_length',
                                    bottom_horizontal_measurement = 'width_at_0.75_length')


# make ready to convert to TPS format (thin plate spline)
polys_lmk <-
polys %>%
  group_by(fill) %>%
  mutate(landmark.number = row_number(fill),
         specimen.ids  = fill) %>%
  ungroup() %>%
  select(-fill)

# export as TPS file
create_tps(polys_lmk,
           here::here("data/landmarks.tps"))

```


<!--QH: I have been fiddling about with code and github for awhile. I plan on fixing everything when I wake up, and, failing that, Friday afternoon.-->
```{r}
ma_flakes_tr_with_groups <-
  ma_flakes_tr %>%
  mutate(dorsal_cortext_group = as.factor(
           case_when(
             between(dorsal_cortex_perc, 0, 0) ~ "Tertiary",
             between(dorsal_cortex_perc, 1, 50) ~ "Secondary",
             between(dorsal_cortex_perc, 51, 100) ~ "Primary"
           ))) %>% 
 mutate(mass_group = as.factor(test_result_mass$cluster))
# plot mass groups
ggplot(ma_flakes_tr_with_groups)  +
  aes(mass,
      fill = mass_group) +
  geom_histogram() +
  scale_fill_viridis_d(name = "Mass\ncluster") +
  xlab("Mass (g)") +
  theme_minimal(base_size = 14) +
  theme(panel.background = element_rect(fill='white',
                                        colour = "white"),
        plot.background = element_rect(fill='white',
                                       colour = "white"))



```


```{r get-data, eval = FALSE}
# Note the path that we need to use to access our data files when rendering this document
my_data <- read.csv(here::here('analysis/data/raw_data/my_csv_file.csv'))
```

```{r demo-plot, fig.cap="A plot of random numbers"}
plot(rnorm(10))
```

Figure \@ref(fig:demo-plot) shows how we can have a caption and cross-reference for a plot

```{r demo-inline-code}
x <- round(pi, 2)
```

Here is an example of inline code `r x` in the middle of a sentence. 

# Discussion

# Conclusion

# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

## References 

Borel, Antony, Richard Cornette, and Michel Baylac. 2017. “Stone Tool Forms and Functions: A Morphometric Analysis of Modern Humans’ Stone Tools From Song Terus Cave (Java, Indonesia).” Archaeometry 59 (3): 455–71. https://doi.org/10.1111/arcm.12264.

Borel, Antony, Claire Gaillard, Marie-Hélène Moncel, Robert Sala, Emmanuelle Pouydebat, Truman Simanjuntak, and François Sémah. 2013. “How to Interpret Informal Flakes Assemblages? Integrating Morphological Description, Usewear and Morphometric Analysis Gave Better Understanding of the Behaviors of Anatomically Modern Human from Song Terus (Indonesia).” Journal of Anthropological Archaeology 32 (4): 630–46. https://doi.org/10.1016/j.jaa.2013.03.002.

Bradbury, Andrew P., and Philip J. Carr. "Flake Typologies and Alternative Approaches: An Experimental Assessment." Lithic Technology 20, no. 2 (1995): 100-15. Accessed June 11, 2021. http://www.jstor.org/stable/23273168.

Mijares, A. 2008. “The late pleistocene to early holocene foragers of northern Luzon.”		Bulletin of the Indo-Pacific Prehistory Association 28: 99-107.

Theska, T., Sieriebriennikov, B., Wighard, S. S., Werner, M. S., & Sommer, R. J. (2020). Geometric morphometrics of microscopic animals as exemplified by model nematodes. Nature Protocols, 15(8), 2611–2644. https://doi.org/10.1038/s41596-020-0347-z
 

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

<div id="refs"></div>

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
